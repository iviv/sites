<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Java HTTP App DevOps Pipeline Manual</title>
<style>
*,*::before,*::after{box-sizing:border-box;margin:0;padding:0}
:root{
  --bg:#0f0f13;--surface:#1a1a24;--surface2:#24243a;--surface3:#2e2e48;
  --border:#3a3a5c;--text:#e2e2f0;--text-muted:#9494b8;
  --java:#f89820;--java-dark:#c97a1a;--blue:#6c8cff;--green:#5cdb95;
  --purple:#b388ff;--cyan:#64ffda;--red:#ff6b6b;--yellow:#ffd93d;
  --code-bg:#12121c;--font-mono:'JetBrains Mono','Fira Code','Cascadia Code','SF Mono',monospace;
  --font-sans:'Inter',-apple-system,BlinkMacSystemFont,'Segoe UI',sans-serif;
  --glow:0 0 20px rgba(108,140,255,.15);
}
html{scroll-behavior:smooth;font-size:16px}
body{font-family:var(--font-sans);background:var(--bg);color:var(--text);line-height:1.7}
a{color:var(--blue);text-decoration:none;transition:color .15s}
a:hover{color:var(--cyan);text-decoration:underline}
::selection{background:var(--blue);color:#fff}

/* Scroll progress */
.progress-track{position:fixed;top:0;left:0;right:0;height:3px;background:var(--surface2);z-index:500}
.progress-bar{height:100%;background:linear-gradient(90deg,var(--java),var(--blue),var(--cyan));width:0%;transition:width .1s}

/* Layout */
.wrapper{display:flex;min-height:100vh}

/* Sidebar */
nav.sidebar{
  position:fixed;top:0;left:0;width:290px;height:100vh;overflow-y:auto;
  background:var(--surface);border-right:1px solid var(--border);z-index:100;
  transition:transform .3s ease;display:flex;flex-direction:column;
}
nav.sidebar::-webkit-scrollbar{width:4px}
nav.sidebar::-webkit-scrollbar-thumb{background:var(--border);border-radius:4px}

.sidebar-header{
  padding:1.5rem;border-bottom:1px solid var(--border);flex-shrink:0;
}
.sidebar-header .logo{
  font-size:1rem;font-weight:700;color:var(--java);display:flex;align-items:center;gap:.6rem;
}
.sidebar-header .logo .icon{font-size:1.5rem}
.sidebar-header .subtitle{color:var(--text-muted);font-size:.72rem;margin-top:.35rem;line-height:1.4;letter-spacing:.02em}

.sidebar-nav{flex:1;overflow-y:auto;padding:.75rem 0}
nav.sidebar ul{list-style:none}
nav.sidebar ul li a{
  display:flex;align-items:center;gap:.6rem;padding:.4rem 1.5rem;font-size:.82rem;
  color:var(--text-muted);border-left:3px solid transparent;transition:all .15s;
}
nav.sidebar ul li a:hover,nav.sidebar ul li a.active{
  color:var(--cyan);background:rgba(100,255,218,.04);border-left-color:var(--cyan);text-decoration:none;
}
nav.sidebar ul li a .nav-num{
  font-family:var(--font-mono);font-size:.65rem;color:var(--text-muted);opacity:.5;min-width:1.6rem;
}
nav.sidebar ul li.section-label{
  padding:.9rem 1.5rem .3rem;font-size:.6rem;text-transform:uppercase;
  letter-spacing:.15em;color:var(--java);font-weight:700;
}

/* Main content */
main.content{margin-left:290px;flex:1;max-width:920px;padding:2.5rem 3rem 4rem}

/* Hero */
.hero{
  padding:2.5rem 0 2rem;margin-bottom:2rem;border-bottom:1px solid var(--border);
}
.hero h1{font-size:2.2rem;font-weight:800;letter-spacing:-.02em;line-height:1.2}
.hero h1 .accent{
  background:linear-gradient(135deg,var(--java),var(--blue));
  -webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text;
}
.hero .tagline{color:var(--text-muted);font-size:1rem;margin-top:.5rem;font-weight:400}
.hero .pipeline-flow{
  display:flex;flex-wrap:wrap;align-items:center;gap:.5rem;margin-top:1.5rem;
}
.hero .pipeline-flow .node{
  background:var(--surface2);border:1px solid var(--border);border-radius:6px;
  padding:.4rem .8rem;font-size:.78rem;font-family:var(--font-mono);color:var(--text);
  display:flex;align-items:center;gap:.4rem;
}
.hero .pipeline-flow .node .dot{width:6px;height:6px;border-radius:50%}
.hero .pipeline-flow .arrow{color:var(--text-muted);font-size:.7rem}

section{margin-bottom:3rem}
h2{font-size:1.5rem;font-weight:700;margin-bottom:1rem;padding-bottom:.5rem;border-bottom:1px solid var(--border);color:var(--text);display:flex;align-items:center;gap:.6rem}
h2 .section-icon{font-size:1.1rem}
h3{font-size:1.1rem;font-weight:600;margin:1.75rem 0 .75rem;color:var(--purple)}
h4{font-size:.95rem;font-weight:600;margin:1.25rem 0 .5rem;color:var(--cyan)}
p{margin-bottom:1rem;color:var(--text-muted)}
ul,ol{margin:0 0 1rem 1.5rem;color:var(--text-muted)}
li{margin-bottom:.3rem}
li code,p code{
  font-family:var(--font-mono);font-size:.82em;background:var(--surface2);
  padding:.15em .4em;border-radius:4px;color:var(--cyan);border:1px solid var(--border);
}
strong{color:var(--text)}

/* Code blocks */
pre{
  background:var(--code-bg);border:1px solid var(--border);border-radius:8px;
  padding:1.2rem 1.4rem;overflow-x:auto;margin:0 0 1.5rem;position:relative;
  font-family:var(--font-mono);font-size:.8rem;line-height:1.7;color:var(--text);
}
pre::before{
  content:attr(data-lang);position:absolute;top:.5rem;right:.75rem;
  font-size:.6rem;text-transform:uppercase;letter-spacing:.1em;
  color:var(--text-muted);opacity:.5;font-family:var(--font-sans);font-weight:600;
}
pre .cm{color:#6a6a8e;font-style:italic}
pre .kw{color:var(--blue)}
pre .str{color:var(--green)}
pre .fn{color:var(--yellow)}
pre .var{color:var(--java)}
pre .tag{color:var(--red)}
pre .attr{color:var(--purple)}

/* Callouts */
.callout{
  padding:1rem 1.25rem;border-radius:6px;margin:1rem 0 1.5rem;
  border-left:4px solid;font-size:.9rem;
}
.callout.tip{background:rgba(92,219,149,.06);border-color:var(--green);color:var(--green)}
.callout.warn{background:rgba(255,217,61,.06);border-color:var(--yellow);color:var(--yellow)}
.callout.danger{background:rgba(255,107,107,.06);border-color:var(--red);color:var(--red)}
.callout.info{background:rgba(108,140,255,.06);border-color:var(--blue);color:var(--blue)}
.callout strong{color:inherit}
.callout p{color:inherit;margin:0}
.callout code{background:rgba(255,255,255,.08);border-color:transparent;color:inherit}

/* Tables */
table{width:100%;border-collapse:collapse;margin:1rem 0 1.5rem;font-size:.85rem}
th{text-align:left;padding:.6rem .75rem;background:var(--surface2);color:var(--text);border:1px solid var(--border);font-weight:600}
td{padding:.6rem .75rem;border:1px solid var(--border);color:var(--text-muted)}
td code{font-size:.8em}

/* File tree */
.file-tree{
  background:var(--code-bg);border:1px solid var(--border);border-radius:8px;
  padding:1rem 1.4rem;margin:0 0 1.5rem;font-family:var(--font-mono);
  font-size:.8rem;line-height:1.8;color:var(--text-muted);
  white-space:pre;overflow-x:auto;
}
.file-tree .dir{color:var(--blue)}
.file-tree .file{color:var(--text)}
.file-tree .desc{color:#6a6a8e}

/* Checklist */
.checklist{list-style:none;margin-left:0;padding:0}
.checklist li{
  padding:.4rem 0 .4rem 2rem;position:relative;color:var(--text-muted);
}
.checklist li::before{
  content:'';position:absolute;left:0;top:.65rem;width:16px;height:16px;
  border:2px solid var(--border);border-radius:4px;
}
.checklist li.done{color:var(--green)}
.checklist li.done::before{
  background:var(--green);border-color:var(--green);
}
.checklist li.done::after{
  content:'';position:absolute;left:3px;top:.7rem;width:10px;height:6px;
  border-left:2px solid var(--bg);border-bottom:2px solid var(--bg);transform:rotate(-45deg);
}

/* Tags */
.badge{
  display:inline-block;font-size:.65rem;padding:.2em .6em;border-radius:4px;
  font-weight:700;text-transform:uppercase;letter-spacing:.05em;
  font-family:var(--font-mono);vertical-align:middle;
}
.badge.xml{background:rgba(255,107,107,.15);color:var(--red)}
.badge.bash{background:rgba(92,219,149,.15);color:var(--green)}
.badge.groovy{background:rgba(108,140,255,.15);color:var(--blue)}
.badge.yaml{background:rgba(179,136,255,.15);color:var(--purple)}
.badge.docker{background:rgba(100,255,218,.15);color:var(--cyan)}
.badge.java{background:rgba(248,152,32,.15);color:var(--java)}

/* Responsive */
.hamburger{
  display:none;position:fixed;top:1rem;left:1rem;z-index:200;
  background:var(--surface);border:1px solid var(--border);border-radius:6px;
  padding:.5rem .7rem;cursor:pointer;color:var(--text);font-size:1.2rem;
}
.overlay{display:none;position:fixed;inset:0;background:rgba(0,0,0,.7);z-index:50}

@media(max-width:860px){
  nav.sidebar{transform:translateX(-100%)}
  nav.sidebar.open{transform:translateX(0)}
  main.content{margin-left:0;padding:1.5rem 1.25rem}
  .hamburger{display:block}
  .overlay.show{display:block}
  .hero h1{font-size:1.5rem}
  h2{font-size:1.25rem}
  .hero .pipeline-flow{gap:.35rem}
  .hero .pipeline-flow .node{font-size:.7rem;padding:.3rem .6rem}
}

/* Smooth fade-in */
section{animation:fadeUp .4s ease both}
@keyframes fadeUp{from{opacity:0;transform:translateY(12px)}to{opacity:1;transform:none}}

footer{margin-top:3rem;padding:2rem 0;border-top:1px solid var(--border);text-align:center;color:var(--text-muted);font-size:.75rem}
footer a{color:var(--java)}
</style>
</head>
<body>

<div class="progress-track"><div class="progress-bar" id="progress"></div></div>
<button class="hamburger" id="hamburger">&#9776;</button>
<div class="overlay" id="overlay"></div>

<div class="wrapper">
<nav class="sidebar" id="sidebar">
  <div class="sidebar-header">
    <div class="logo"><span class="icon">&#9749;</span> JavaOps Pipeline</div>
    <div class="subtitle">Maven &rarr; Jenkins &rarr; Docker &rarr; Helm &rarr; K8s<br>Complete DevOps Reference</div>
  </div>
  <div class="sidebar-nav">
  <ul>
    <li class="section-label">Overview</li>
    <li><a href="#architecture"><span class="nav-num">01</span> Architecture</a></li>
    <li><a href="#prerequisites"><span class="nav-num">02</span> Prerequisites</a></li>
    <li class="section-label">Build</li>
    <li><a href="#maven"><span class="nav-num">03</span> Maven Build</a></li>
    <li><a href="#docker"><span class="nav-num">04</span> Docker</a></li>
    <li class="section-label">CI/CD</li>
    <li><a href="#jenkins"><span class="nav-num">05</span> Jenkins Pipeline</a></li>
    <li><a href="#shared-libs"><span class="nav-num">06</span> Shared Libraries</a></li>
    <li class="section-label">Packaging</li>
    <li><a href="#helm"><span class="nav-num">07</span> Helm Charts</a></li>
    <li><a href="#helm-templates"><span class="nav-num">08</span> Helm Templates</a></li>
    <li><a href="#helm-ops"><span class="nav-num">09</span> Helm Operations</a></li>
    <li class="section-label">Deployment</li>
    <li><a href="#k8s-prep"><span class="nav-num">10</span> K8s Setup</a></li>
    <li><a href="#k8s-manifests"><span class="nav-num">11</span> K8s Manifests</a></li>
    <li><a href="#health"><span class="nav-num">12</span> Health &amp; Monitoring</a></li>
    <li class="section-label">Advanced</li>
    <li><a href="#gitops"><span class="nav-num">13</span> GitOps / ArgoCD</a></li>
    <li><a href="#strategies"><span class="nav-num">14</span> Deploy Strategies</a></li>
    <li><a href="#secrets-mgmt"><span class="nav-num">15</span> Secrets Mgmt</a></li>
    <li class="section-label">Operations</li>
    <li><a href="#troubleshooting"><span class="nav-num">16</span> Troubleshooting</a></li>
    <li><a href="#jvm-tuning"><span class="nav-num">17</span> JVM Tuning</a></li>
    <li><a href="#checklist"><span class="nav-num">18</span> Checklist</a></li>
  </ul>
  </div>
</nav>

<main class="content">

<!-- HERO -->
<div class="hero">
  <h1>Java HTTP App <span class="accent">DevOps Pipeline</span></h1>
  <p class="tagline">Complete guide: from <code>mvn clean package</code> to production pods. For engineers who grep before they Google.</p>
  <div class="pipeline-flow">
    <div class="node"><span class="dot" style="background:var(--text-muted)"></span>Git</div>
    <span class="arrow">&rarr;</span>
    <div class="node"><span class="dot" style="background:var(--blue)"></span>Jenkins</div>
    <span class="arrow">&rarr;</span>
    <div class="node"><span class="dot" style="background:var(--java)"></span>Maven</div>
    <span class="arrow">&rarr;</span>
    <div class="node"><span class="dot" style="background:var(--cyan)"></span>Docker</div>
    <span class="arrow">&rarr;</span>
    <div class="node"><span class="dot" style="background:var(--purple)"></span>Helm</div>
    <span class="arrow">&rarr;</span>
    <div class="node"><span class="dot" style="background:var(--green)"></span>Kubernetes</div>
  </div>
</div>

<!-- ============================================================ -->
<section id="architecture">
<h2><span class="section-icon">&#9881;</span> Architecture Overview</h2>
<p>The pipeline flows through six stages, each isolated and independently testable. Failures at any stage halt downstream progression.</p>

<pre data-lang="flow">Source Code (Git)
    &darr;
Jenkins (CI/CD Orchestration)
    &darr;
Maven Build &amp; Test           <span class="cm">// compile, unit tests, SAST</span>
    &darr;
Docker Image Creation         <span class="cm">// multi-stage build, CVE scan</span>
    &darr;
Registry (Harbor/ECR/ACR)     <span class="cm">// immutable tags, signature</span>
    &darr;
Helm Chart Packaging          <span class="cm">// lint, template, version</span>
    &darr;
Kubernetes Deployment         <span class="cm">// rollout, probes, HPA</span>
    &darr;
Production / Staging          <span class="cm">// smoke tests, monitoring</span></pre>

<h3>Key Components</h3>
<table>
<tr><th>Component</th><th>Role</th><th>Why It Matters</th></tr>
<tr><td><strong>Maven</strong></td><td>Build automation &amp; dependency mgmt</td><td>Reproducible builds, lifecycle phases, plugin ecosystem</td></tr>
<tr><td><strong>Jenkins</strong></td><td>CI/CD orchestration</td><td>Pipeline-as-code, parallel stages, approval gates</td></tr>
<tr><td><strong>Docker</strong></td><td>Container runtime &amp; image format</td><td>Immutable artifacts, environment parity</td></tr>
<tr><td><strong>Helm</strong></td><td>K8s package manager</td><td>Templated manifests, release management, rollbacks</td></tr>
<tr><td><strong>Kubernetes</strong></td><td>Container orchestration</td><td>Self-healing, autoscaling, declarative state</td></tr>
</table>
</section>

<!-- ============================================================ -->
<section id="prerequisites">
<h2><span class="section-icon">&#128295;</span> Prerequisites</h2>

<h3>Infrastructure Requirements</h3>
<ul>
  <li>Kubernetes cluster <strong>1.24+</strong> (EKS, GKE, AKS, or self-managed)</li>
  <li>Private container registry (Harbor, ECR, ACR, Artifactory)</li>
  <li>Jenkins server <strong>2.300+</strong> with pipeline plugins</li>
  <li>Maven <strong>3.8.1+</strong> with JDK 17+</li>
  <li><code>kubectl</code> configured with cluster access</li>
  <li>Helm <strong>3.0+</strong></li>
</ul>

<h3>Required Jenkins Plugins</h3>
<pre data-lang="text">Pipeline                    <span class="cm">// Core pipeline engine</span>
Docker Pipeline             <span class="cm">// Docker build/push steps</span>
Kubernetes plugin           <span class="cm">// Dynamic pod-based agents</span>
Git plugin                  <span class="cm">// SCM checkout</span>
Maven Integration           <span class="cm">// Maven tool management</span>
Credentials Binding         <span class="cm">// Secret injection</span>
Pipeline: Stage View        <span class="cm">// Visual pipeline progress</span>
Blue Ocean                  <span class="cm">// Modern UI (recommended)</span>
Kubernetes CLI              <span class="cm">// kubectl/helm steps</span></pre>

<h3>Version Check</h3>
<pre data-lang="bash"><span class="cm"># Verify all tools are installed and accessible</span>
java -version               <span class="cm"># JDK 17+ required for modern Spring Boot</span>
mvn --version               <span class="cm"># 3.8.1+</span>
docker --version            <span class="cm"># 20.10+</span>
kubectl version --client    <span class="cm"># Match cluster minor version &plusmn;1</span>
helm version                <span class="cm"># 3.x only (Helm 2 is EOL)</span></pre>

<div class="callout info"><strong>Pro tip:</strong><p> Use <code>asdf</code> or <code>mise</code> to manage tool versions per-project with a <code>.tool-versions</code> file. No more "works on my machine".</p></div>
</section>

<!-- ============================================================ -->
<section id="maven">
<h2><span class="section-icon">&#9749;</span> Maven Build Process</h2>

<h3>Project Structure</h3>
<div class="file-tree">
<span class="dir">my-java-app/</span>
├── <span class="file">pom.xml</span>                  <span class="desc"># Build config &amp; dependencies</span>
├── <span class="dir">src/</span>
│   ├── <span class="dir">main/</span>
│   │   ├── <span class="dir">java/com/example/</span>
│   │   │   └── <span class="file">App.java</span>
│   │   └── <span class="dir">resources/</span>
│   │       ├── <span class="file">application.yml</span>  <span class="desc"># Spring Boot config</span>
│   │       └── <span class="file">logback.xml</span>      <span class="desc"># Logging config</span>
│   └── <span class="dir">test/</span>
│       ├── <span class="dir">java/</span>
│       └── <span class="dir">resources/</span>
├── <span class="file">Dockerfile</span>               <span class="desc"># Multi-stage container build</span>
├── <span class="dir">helm/my-java-app/</span>        <span class="desc"># Helm chart</span>
└── <span class="file">Jenkinsfile</span>              <span class="desc"># Pipeline definition</span>
</div>

<h3>POM Configuration</h3>
<pre data-lang="xml"><span class="tag">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span>
<span class="tag">&lt;project</span> <span class="attr">xmlns</span>=<span class="str">"http://maven.apache.org/POM/4.0.0"</span><span class="tag">&gt;</span>
    <span class="tag">&lt;modelVersion&gt;</span>4.0.0<span class="tag">&lt;/modelVersion&gt;</span>

    <span class="tag">&lt;groupId&gt;</span>com.example<span class="tag">&lt;/groupId&gt;</span>
    <span class="tag">&lt;artifactId&gt;</span>my-java-app<span class="tag">&lt;/artifactId&gt;</span>
    <span class="tag">&lt;version&gt;</span>1.0.0-SNAPSHOT<span class="tag">&lt;/version&gt;</span>
    <span class="tag">&lt;packaging&gt;</span>jar<span class="tag">&lt;/packaging&gt;</span>

    <span class="cm">&lt;!-- Spring Boot Parent: manages dependency versions, plugin defaults --&gt;</span>
    <span class="tag">&lt;parent&gt;</span>
        <span class="tag">&lt;groupId&gt;</span>org.springframework.boot<span class="tag">&lt;/groupId&gt;</span>
        <span class="tag">&lt;artifactId&gt;</span>spring-boot-starter-parent<span class="tag">&lt;/artifactId&gt;</span>
        <span class="tag">&lt;version&gt;</span>3.1.5<span class="tag">&lt;/version&gt;</span>
    <span class="tag">&lt;/parent&gt;</span>

    <span class="tag">&lt;properties&gt;</span>
        <span class="tag">&lt;maven.compiler.source&gt;</span>17<span class="tag">&lt;/maven.compiler.source&gt;</span>
        <span class="tag">&lt;maven.compiler.target&gt;</span>17<span class="tag">&lt;/maven.compiler.target&gt;</span>
        <span class="tag">&lt;project.build.sourceEncoding&gt;</span>UTF-8<span class="tag">&lt;/project.build.sourceEncoding&gt;</span>
    <span class="tag">&lt;/properties&gt;</span>

    <span class="tag">&lt;dependencies&gt;</span>
        <span class="tag">&lt;dependency&gt;</span>
            <span class="tag">&lt;groupId&gt;</span>org.springframework.boot<span class="tag">&lt;/groupId&gt;</span>
            <span class="tag">&lt;artifactId&gt;</span>spring-boot-starter-web<span class="tag">&lt;/artifactId&gt;</span>
        <span class="tag">&lt;/dependency&gt;</span>
        <span class="tag">&lt;dependency&gt;</span>
            <span class="tag">&lt;groupId&gt;</span>org.springframework.boot<span class="tag">&lt;/groupId&gt;</span>
            <span class="tag">&lt;artifactId&gt;</span>spring-boot-starter-actuator<span class="tag">&lt;/artifactId&gt;</span>
        <span class="tag">&lt;/dependency&gt;</span>
        <span class="tag">&lt;dependency&gt;</span>
            <span class="tag">&lt;groupId&gt;</span>io.micrometer<span class="tag">&lt;/groupId&gt;</span>
            <span class="tag">&lt;artifactId&gt;</span>micrometer-registry-prometheus<span class="tag">&lt;/artifactId&gt;</span>
            <span class="cm">&lt;!-- Enables /actuator/prometheus endpoint --&gt;</span>
        <span class="tag">&lt;/dependency&gt;</span>
        <span class="tag">&lt;dependency&gt;</span>
            <span class="tag">&lt;groupId&gt;</span>org.springframework.boot<span class="tag">&lt;/groupId&gt;</span>
            <span class="tag">&lt;artifactId&gt;</span>spring-boot-starter-test<span class="tag">&lt;/artifactId&gt;</span>
            <span class="tag">&lt;scope&gt;</span>test<span class="tag">&lt;/scope&gt;</span>
        <span class="tag">&lt;/dependency&gt;</span>
    <span class="tag">&lt;/dependencies&gt;</span>

    <span class="tag">&lt;build&gt;</span>
        <span class="tag">&lt;plugins&gt;</span>
            <span class="tag">&lt;plugin&gt;</span>
                <span class="tag">&lt;groupId&gt;</span>org.springframework.boot<span class="tag">&lt;/groupId&gt;</span>
                <span class="tag">&lt;artifactId&gt;</span>spring-boot-maven-plugin<span class="tag">&lt;/artifactId&gt;</span>
                <span class="tag">&lt;executions&gt;</span>
                    <span class="tag">&lt;execution&gt;</span>
                        <span class="tag">&lt;goals&gt;&lt;goal&gt;</span>repackage<span class="tag">&lt;/goal&gt;&lt;/goals&gt;</span>
                    <span class="tag">&lt;/execution&gt;</span>
                <span class="tag">&lt;/executions&gt;</span>
            <span class="tag">&lt;/plugin&gt;</span>
            <span class="tag">&lt;plugin&gt;</span>
                <span class="tag">&lt;groupId&gt;</span>org.apache.maven.plugins<span class="tag">&lt;/groupId&gt;</span>
                <span class="tag">&lt;artifactId&gt;</span>maven-compiler-plugin<span class="tag">&lt;/artifactId&gt;</span>
                <span class="tag">&lt;version&gt;</span>3.11.0<span class="tag">&lt;/version&gt;</span>
                <span class="tag">&lt;configuration&gt;</span>
                    <span class="tag">&lt;source&gt;</span>17<span class="tag">&lt;/source&gt;</span>
                    <span class="tag">&lt;target&gt;</span>17<span class="tag">&lt;/target&gt;</span>
                <span class="tag">&lt;/configuration&gt;</span>
            <span class="tag">&lt;/plugin&gt;</span>
            <span class="tag">&lt;plugin&gt;</span>
                <span class="tag">&lt;groupId&gt;</span>org.apache.maven.plugins<span class="tag">&lt;/groupId&gt;</span>
                <span class="tag">&lt;artifactId&gt;</span>maven-surefire-plugin<span class="tag">&lt;/artifactId&gt;</span>
                <span class="tag">&lt;version&gt;</span>3.0.0<span class="tag">&lt;/version&gt;</span>
            <span class="tag">&lt;/plugin&gt;</span>
        <span class="tag">&lt;/plugins&gt;</span>
    <span class="tag">&lt;/build&gt;</span>
<span class="tag">&lt;/project&gt;</span></pre>

<h3>Build Lifecycle Phases</h3>
<pre data-lang="bash">mvn clean              <span class="cm"># Delete target/</span>
mvn compile            <span class="cm"># Compile source &rarr; target/classes</span>
mvn test               <span class="cm"># Run unit tests (Surefire)</span>
mvn package            <span class="cm"># Create JAR in target/</span>
mvn verify             <span class="cm"># Run integration tests (Failsafe)</span>
mvn install            <span class="cm"># Install to ~/.m2/repository</span>
mvn deploy             <span class="cm"># Deploy to remote artifact repo</span></pre>

<h3>Maven Settings for Private Repos</h3>
<pre data-lang="xml"><span class="cm">&lt;!-- ~/.m2/settings.xml --&gt;</span>
<span class="tag">&lt;settings&gt;</span>
    <span class="tag">&lt;servers&gt;</span>
        <span class="tag">&lt;server&gt;</span>
            <span class="tag">&lt;id&gt;</span>nexus-releases<span class="tag">&lt;/id&gt;</span>
            <span class="tag">&lt;username&gt;</span>${env.NEXUS_USER}<span class="tag">&lt;/username&gt;</span>
            <span class="tag">&lt;password&gt;</span>${env.NEXUS_TOKEN}<span class="tag">&lt;/password&gt;</span>
        <span class="tag">&lt;/server&gt;</span>
    <span class="tag">&lt;/servers&gt;</span>
    <span class="tag">&lt;mirrors&gt;</span>
        <span class="tag">&lt;mirror&gt;</span>
            <span class="tag">&lt;id&gt;</span>nexus<span class="tag">&lt;/id&gt;</span>
            <span class="tag">&lt;mirrorOf&gt;</span>*<span class="tag">&lt;/mirrorOf&gt;</span>
            <span class="tag">&lt;url&gt;</span>https://nexus.company.com/repository/maven-public<span class="tag">&lt;/url&gt;</span>
        <span class="tag">&lt;/mirror&gt;</span>
    <span class="tag">&lt;/mirrors&gt;</span>
<span class="tag">&lt;/settings&gt;</span></pre>

<h3>Common Build Commands</h3>
<pre data-lang="bash"><span class="cm"># Full build with tests</span>
mvn clean package

<span class="cm"># Skip tests (dev iteration speed)</span>
mvn clean package -DskipTests

<span class="cm"># Build a specific profile</span>
mvn clean package -Pproduction

<span class="cm"># Verbose debug output</span>
mvn clean package -X

<span class="cm"># Dependency analysis</span>
mvn dependency:tree                    <span class="cm"># Full dependency graph</span>
mvn dependency:analyze                 <span class="cm"># Find unused / undeclared deps</span>
mvn versions:display-dependency-updates  <span class="cm"># Check for newer versions</span>

<span class="cm"># Run specific test class or method</span>
mvn test -Dtest=UserControllerTest
mvn test -Dtest=UserControllerTest#testGetUser

<span class="cm"># Parallel builds (use available cores)</span>
mvn clean package -T 1C               <span class="cm"># 1 thread per CPU core</span></pre>

<h3>Build Artifacts</h3>
<div class="file-tree">
<span class="dir">target/</span>
├── <span class="file">my-java-app-1.0.0.jar</span>           <span class="desc"># Fat JAR (executable)</span>
├── <span class="file">my-java-app-1.0.0.jar.original</span>  <span class="desc"># Original (before repackage)</span>
├── <span class="dir">classes/</span>                          <span class="desc"># Compiled .class files</span>
├── <span class="dir">test-classes/</span>                     <span class="desc"># Compiled test classes</span>
└── <span class="dir">surefire-reports/</span>                <span class="desc"># JUnit XML + text reports</span>
</div>
</section>

<!-- ============================================================ -->
<section id="docker">
<h2><span class="section-icon">&#128051;</span> Docker Containerization</h2>

<h3>Multi-Stage Dockerfile</h3>
<pre data-lang="dockerfile"><span class="cm"># ---- Stage 1: Build ----</span>
<span class="kw">FROM</span> maven:3.9-eclipse-temurin-17 <span class="kw">AS</span> builder
<span class="kw">WORKDIR</span> /app

<span class="cm"># Cache dependencies (changes less often than source)</span>
<span class="kw">COPY</span> pom.xml .
<span class="kw">RUN</span> mvn dependency:go-offline -B

<span class="cm"># Copy source and build</span>
<span class="kw">COPY</span> src/ src/
<span class="kw">RUN</span> mvn clean package -DskipTests -B

<span class="cm"># ---- Stage 2: Runtime ----</span>
<span class="kw">FROM</span> eclipse-temurin:17-jre-alpine

<span class="cm"># Non-root user for security</span>
<span class="kw">RUN</span> addgroup -S app && adduser -S app -G app

<span class="kw">WORKDIR</span> /app
<span class="kw">COPY</span> --from=builder /app/target/my-java-app-*.jar app.jar
<span class="kw">RUN</span> chown -R app:app /app

<span class="kw">USER</span> app

<span class="kw">HEALTHCHECK</span> --interval=30s --timeout=3s --start-period=60s --retries=3 \
    CMD wget -qO- http://localhost:8080/actuator/health || exit 1

<span class="kw">EXPOSE</span> 8080

<span class="cm"># JVM flags: use percentage-based memory (container-aware)</span>
<span class="kw">ENV</span> JAVA_OPTS="-XX:+UseG1GC \
    -XX:MaxRAMPercentage=75.0 \
    -XX:InitialRAMPercentage=50.0 \
    -XX:+UseStringDeduplication \
    -Djava.security.egd=file:/dev/./urandom"

<span class="kw">ENTRYPOINT</span> ["sh", "-c", "java $JAVA_OPTS -jar app.jar"]</pre>

<div class="callout tip"><strong>Why <code>sh -c</code>?</strong><p> Using <code>ENTRYPOINT ["sh", "-c", ...]</code> allows the <code>$JAVA_OPTS</code> env var to be expanded at runtime. With exec form <code>["java", ...]</code>, env vars are not interpolated.</p></div>

<h3>Layer Caching Strategy</h3>
<pre data-lang="dockerfile"><span class="cm"># BAD: any source change invalidates dependency cache</span>
COPY . /app
RUN mvn clean package

<span class="cm"># GOOD: dependencies cached separately from source</span>
COPY pom.xml .
RUN mvn dependency:go-offline -B    <span class="cm"># Cached until pom.xml changes</span>
COPY src/ src/
RUN mvn clean package -DskipTests   <span class="cm"># Only rebuilds source layer</span></pre>

<h3>Image Size Comparison</h3>
<table>
<tr><th>Base Image</th><th>Approx Size</th><th>Use Case</th></tr>
<tr><td><code>eclipse-temurin:17</code></td><td>~340 MB</td><td>Full JDK, debugging</td></tr>
<tr><td><code>eclipse-temurin:17-jre</code></td><td>~220 MB</td><td>Standard runtime</td></tr>
<tr><td><code>eclipse-temurin:17-jre-alpine</code></td><td>~130 MB</td><td>Production (smallest)</td></tr>
<tr><td><code>gcr.io/distroless/java17</code></td><td>~190 MB</td><td>No shell, max security</td></tr>
</table>

<h3>Build &amp; Push</h3>
<pre data-lang="bash"><span class="cm"># Build with tag</span>
docker build -t my-registry.azurecr.io/my-java-app:1.0.0 .

<span class="cm"># Multi-tag build</span>
docker build \
  -t my-registry.azurecr.io/my-java-app:1.0.0 \
  -t my-registry.azurecr.io/my-java-app:latest .

<span class="cm"># Build with build args</span>
docker build --build-arg JAVA_VERSION=17 -t my-java-app:1.0.0 .

<span class="cm"># Inspect layers and size</span>
docker history my-java-app:1.0.0
docker image inspect my-java-app:1.0.0 --format='{{.Size}}'

<span class="cm"># Push to registry</span>
docker login my-registry.azurecr.io
docker push my-registry.azurecr.io/my-java-app:1.0.0

<span class="cm"># Scan for CVEs before pushing</span>
trivy image --severity HIGH,CRITICAL my-java-app:1.0.0
docker scout cves my-java-app:1.0.0</pre>

<h3>Local Testing</h3>
<pre data-lang="bash"><span class="cm"># Run with Spring profile and port mapping</span>
docker run -p 8080:8080 \
  -e SPRING_PROFILES_ACTIVE=dev \
  -e JAVA_OPTS="-XX:MaxRAMPercentage=75.0" \
  my-java-app:1.0.0

<span class="cm"># Mount external config</span>
docker run -p 8080:8080 \
  -v $(pwd)/config:/app/config \
  my-java-app:1.0.0

<span class="cm"># Verify health</span>
curl -s http://localhost:8080/actuator/health | jq .

<span class="cm"># Follow logs</span>
docker logs -f &lt;container-id&gt;</pre>

<div class="callout warn"><strong>Never use <code>:latest</code> in production.</strong><p> Always pin exact versions. <code>:latest</code> is mutable and makes rollbacks impossible to reason about. Use Git SHA or semver tags.</p></div>
</section>

<!-- ============================================================ -->
<section id="jenkins">
<h2><span class="section-icon">&#128736;</span> Jenkins Pipeline</h2>

<h3>Declarative Pipeline (Jenkinsfile)</h3>
<pre data-lang="groovy"><span class="kw">pipeline</span> {
    <span class="kw">agent</span> any

    <span class="kw">options</span> {
        buildDiscarder(logRotator(numToKeepStr: <span class="str">'10'</span>))
        timeout(time: 1, unit: <span class="str">'HOURS'</span>)
        timestamps()
    }

    <span class="kw">parameters</span> {
        string(name: <span class="str">'VERSION'</span>, defaultValue: <span class="str">'1.0.0'</span>, description: <span class="str">'App version'</span>)
        choice(name: <span class="str">'ENVIRONMENT'</span>, choices: [<span class="str">'dev'</span>, <span class="str">'staging'</span>, <span class="str">'production'</span>])
        booleanParam(name: <span class="str">'SKIP_TESTS'</span>, defaultValue: <span class="kw">false</span>)
    }

    <span class="kw">environment</span> {
        REGISTRY   = <span class="str">'my-registry.azurecr.io'</span>
        IMAGE_NAME = <span class="str">'my-java-app'</span>
        IMAGE_TAG  = <span class="str">"${params.VERSION}"</span>
    }

    <span class="kw">stages</span> {
        stage(<span class="str">'Checkout'</span>) {
            steps { checkout scm }
        }

        stage(<span class="str">'Build'</span>) {
            steps {
                withEnv([<span class="str">'MAVEN_OPTS=-Xmx1024m'</span>]) {
                    sh <span class="str">"""
                        mvn clean package \
                            -DskipTests=\${SKIP_TESTS} \
                            -Drevision=\${VERSION} -B -U
                    """</span>
                }
            }
        }

        stage(<span class="str">'Unit Tests'</span>) {
            <span class="kw">when</span> { expression { !params.SKIP_TESTS } }
            steps {
                sh <span class="str">'mvn test -Drevision=${VERSION} -B'</span>
            }
            <span class="kw">post</span> {
                always { junit <span class="str">'**/surefire-reports/*.xml'</span> }
            }
        }

        stage(<span class="str">'Code Quality'</span>) {
            <span class="kw">parallel</span> {
                stage(<span class="str">'SonarQube'</span>) {
                    steps {
                        sh <span class="str">"""
                            mvn sonar:sonar \
                                -Dsonar.projectKey=my-java-app \
                                -Dsonar.host.url=https://sonar.company.com
                        """</span>
                    }
                }
                stage(<span class="str">'OWASP Dep Check'</span>) {
                    steps {
                        sh <span class="str">'mvn org.owasp:dependency-check-maven:check'</span>
                    }
                }
            }
        }

        stage(<span class="str">'Docker Build &amp; Push'</span>) {
            steps {
                withDockerRegistry([credentialsId: <span class="str">'docker-creds'</span>]) {
                    sh <span class="str">"""
                        docker build \
                            --build-arg VERSION=\${VERSION} \
                            -t \${REGISTRY}/\${IMAGE_NAME}:\${IMAGE_TAG} \
                            -t \${REGISTRY}/\${IMAGE_NAME}:latest .

                        trivy image --severity HIGH,CRITICAL \
                            --exit-code 0 \
                            \${REGISTRY}/\${IMAGE_NAME}:\${IMAGE_TAG}

                        docker push \${REGISTRY}/\${IMAGE_NAME}:\${IMAGE_TAG}
                        docker push \${REGISTRY}/\${IMAGE_NAME}:latest
                    """</span>
                }
            }
        }

        stage(<span class="str">'Helm Lint &amp; Package'</span>) {
            steps {
                sh <span class="str">"""
                    helm lint helm/my-java-app --strict
                    helm package helm/my-java-app \
                        --version \${VERSION} --app-version \${VERSION}
                """</span>
            }
        }

        stage(<span class="str">'Deploy to Dev'</span>) {
            <span class="kw">when</span> { expression { params.ENVIRONMENT in [<span class="str">'dev'</span>, <span class="str">'staging'</span>] } }
            steps {
                withCredentials([file(credentialsId: <span class="str">'kubeconfig-dev'</span>, variable: <span class="str">'KUBECONFIG'</span>)]) {
                    sh <span class="str">"""
                        helm upgrade --install my-java-app helm/my-java-app \
                            --namespace dev --create-namespace \
                            --values helm/my-java-app/values-dev.yaml \
                            --set image.tag=\${IMAGE_TAG} \
                            --set image.repository=\${REGISTRY}/\${IMAGE_NAME} \
                            --timeout 5m --wait --atomic

                        kubectl rollout status deployment/my-java-app \
                            -n dev --timeout=5m
                    """</span>
                }
            }
        }

        stage(<span class="str">'Smoke Tests'</span>) {
            <span class="kw">when</span> { expression { params.ENVIRONMENT in [<span class="str">'dev'</span>, <span class="str">'staging'</span>] } }
            steps {
                sh <span class="str">"""
                    kubectl run smoke-test --rm -i --restart=Never \
                        --image=curlimages/curl -n dev -- \
                        curl -sf http://my-java-app:8080/actuator/health/readiness
                """</span>
            }
        }

        stage(<span class="str">'Deploy to Production'</span>) {
            <span class="kw">when</span> {
                allOf {
                    expression { params.ENVIRONMENT == <span class="str">'production'</span> }
                    branch <span class="str">'main'</span>
                }
            }
            <span class="kw">input</span> { message <span class="str">"Deploy to production?"</span>; ok <span class="str">"Deploy"</span> }
            steps {
                withCredentials([file(credentialsId: <span class="str">'kubeconfig-prod'</span>, variable: <span class="str">'KUBECONFIG'</span>)]) {
                    sh <span class="str">"""
                        helm upgrade --install my-java-app helm/my-java-app \
                            --namespace production --create-namespace \
                            --values helm/my-java-app/values-production.yaml \
                            --set image.tag=\${IMAGE_TAG} \
                            --set image.repository=\${REGISTRY}/\${IMAGE_NAME} \
                            --timeout 10m --wait --atomic

                        kubectl rollout status deployment/my-java-app \
                            -n production --timeout=10m
                    """</span>
                }
            }
        }
    }

    <span class="kw">post</span> {
        always  { cleanWs(deleteDirs: <span class="kw">true</span>) }
        success { echo <span class="str">'Pipeline succeeded!'</span> }
        failure { echo <span class="str">'Pipeline failed - check logs.'</span> }
    }
}</pre>
</section>

<!-- ============================================================ -->
<section id="shared-libs">
<h2><span class="section-icon">&#128218;</span> Jenkins Shared Libraries</h2>
<p>Reusable pipeline code for teams with multiple Java services.</p>

<h3>vars/mavenBuild.groovy</h3>
<pre data-lang="groovy"><span class="kw">def</span> <span class="fn">call</span>(String version, boolean skipTests = <span class="kw">false</span>) {
    sh <span class="str">"""
        mvn clean package \
            -DskipTests=\${skipTests} \
            -Drevision=\${version} -B
    """</span>
}</pre>

<h3>Usage in Pipeline</h3>
<pre data-lang="groovy"><span class="kw">@Library</span>(<span class="str">'shared-library'</span>) _

<span class="kw">pipeline</span> {
    <span class="kw">agent</span> any
    <span class="kw">stages</span> {
        stage(<span class="str">'Build'</span>) {
            steps { script { mavenBuild(<span class="str">'1.0.0'</span>, <span class="kw">false</span>) } }
        }
    }
}</pre>

<div class="callout info"><strong>Shared library structure:</strong><p> Place under <code>vars/</code> for global pipeline steps, <code>src/</code> for helper classes, and <code>resources/</code> for non-Groovy files. Configure in Jenkins &rarr; Manage Jenkins &rarr; Configure System &rarr; Global Pipeline Libraries.</p></div>
</section>

<!-- ============================================================ -->
<section id="helm">
<h2><span class="section-icon">&#9875;</span> Helm Chart Structure</h2>

<div class="file-tree">
<span class="dir">helm/my-java-app/</span>
├── <span class="file">Chart.yaml</span>               <span class="desc"># Chart metadata &amp; version</span>
├── <span class="file">values.yaml</span>              <span class="desc"># Default values</span>
├── <span class="file">values-dev.yaml</span>          <span class="desc"># Dev overrides</span>
├── <span class="file">values-staging.yaml</span>      <span class="desc"># Staging overrides</span>
├── <span class="file">values-production.yaml</span>   <span class="desc"># Production overrides</span>
├── <span class="dir">templates/</span>
│   ├── <span class="file">_helpers.tpl</span>         <span class="desc"># Template helpers &amp; labels</span>
│   ├── <span class="file">deployment.yaml</span>      <span class="desc"># Deployment spec</span>
│   ├── <span class="file">service.yaml</span>         <span class="desc"># ClusterIP / LoadBalancer</span>
│   ├── <span class="file">ingress.yaml</span>         <span class="desc"># Ingress rules + TLS</span>
│   ├── <span class="file">configmap.yaml</span>       <span class="desc"># Application config</span>
│   ├── <span class="file">hpa.yaml</span>             <span class="desc"># Horizontal Pod Autoscaler</span>
│   ├── <span class="file">pdb.yaml</span>             <span class="desc"># Pod Disruption Budget</span>
│   ├── <span class="file">serviceaccount.yaml</span>  <span class="desc"># SA + IRSA/Workload Identity</span>
│   └── <span class="file">secret.yaml</span>          <span class="desc"># Sealed/External secrets</span>
└── <span class="file">README.md</span>
</div>

<h3>Chart.yaml</h3>
<pre data-lang="yaml"><span class="kw">apiVersion</span>: v2
<span class="kw">name</span>: my-java-app
<span class="kw">description</span>: Helm chart for Java Spring Boot HTTP application
<span class="kw">type</span>: application
<span class="kw">version</span>: 1.0.0          <span class="cm"># Chart version (change on chart modifications)</span>
<span class="kw">appVersion</span>: "1.0.0"     <span class="cm"># Application version (matches Docker tag)</span>
<span class="kw">keywords</span>: [java, spring-boot, http]
<span class="kw">maintainers</span>:
  - <span class="kw">name</span>: DevOps Team
    <span class="kw">email</span>: devops@company.com</pre>

<h3>values.yaml (Production-Grade)</h3>
<pre data-lang="yaml"><span class="cm"># ---- Image ----</span>
<span class="kw">image</span>:
  <span class="kw">repository</span>: my-registry.azurecr.io/my-java-app
  <span class="kw">tag</span>: <span class="str">"1.0.0"</span>
  <span class="kw">pullPolicy</span>: IfNotPresent

<span class="cm"># ---- Replicas &amp; Scaling ----</span>
<span class="kw">replicaCount</span>: 3

<span class="kw">autoscaling</span>:
  <span class="kw">enabled</span>: <span class="kw">true</span>
  <span class="kw">minReplicas</span>: 2
  <span class="kw">maxReplicas</span>: 10
  <span class="kw">targetCPUUtilizationPercentage</span>: 75
  <span class="kw">targetMemoryUtilizationPercentage</span>: 80

<span class="kw">podDisruptionBudget</span>:
  <span class="kw">enabled</span>: <span class="kw">true</span>
  <span class="kw">minAvailable</span>: 1

<span class="cm"># ---- Resources ----</span>
<span class="kw">resources</span>:
  <span class="kw">requests</span>:
    <span class="kw">cpu</span>: 250m
    <span class="kw">memory</span>: 256Mi
  <span class="kw">limits</span>:
    <span class="kw">cpu</span>: 500m
    <span class="kw">memory</span>: 512Mi

<span class="cm"># ---- Security ----</span>
<span class="kw">podSecurityContext</span>:
  <span class="kw">runAsNonRoot</span>: <span class="kw">true</span>
  <span class="kw">runAsUser</span>: 1000
  <span class="kw">fsGroup</span>: 1000
  <span class="kw">seccompProfile</span>:
    <span class="kw">type</span>: RuntimeDefault

<span class="kw">securityContext</span>:
  <span class="kw">allowPrivilegeEscalation</span>: <span class="kw">false</span>
  <span class="kw">capabilities</span>:
    <span class="kw">drop</span>: [ALL]
  <span class="kw">readOnlyRootFilesystem</span>: <span class="kw">true</span>

<span class="cm"># ---- Probes ----</span>
<span class="kw">startupProbe</span>:
  <span class="kw">enabled</span>: <span class="kw">true</span>
  <span class="kw">httpGet</span>:
    <span class="kw">path</span>: /actuator/health/startup
    <span class="kw">port</span>: http
  <span class="kw">periodSeconds</span>: 10
  <span class="kw">failureThreshold</span>: 30          <span class="cm"># 5 min max startup time</span>

<span class="kw">readinessProbe</span>:
  <span class="kw">enabled</span>: <span class="kw">true</span>
  <span class="kw">httpGet</span>:
    <span class="kw">path</span>: /actuator/health/readiness
    <span class="kw">port</span>: http
  <span class="kw">initialDelaySeconds</span>: 5
  <span class="kw">periodSeconds</span>: 10

<span class="kw">livenessProbe</span>:
  <span class="kw">enabled</span>: <span class="kw">true</span>
  <span class="kw">httpGet</span>:
    <span class="kw">path</span>: /actuator/health/liveness
    <span class="kw">port</span>: http
  <span class="kw">initialDelaySeconds</span>: 60
  <span class="kw">periodSeconds</span>: 10

<span class="cm"># ---- Networking ----</span>
<span class="kw">service</span>:
  <span class="kw">type</span>: ClusterIP
  <span class="kw">port</span>: 8080

<span class="kw">ingress</span>:
  <span class="kw">enabled</span>: <span class="kw">true</span>
  <span class="kw">className</span>: nginx
  <span class="kw">annotations</span>:
    cert-manager.io/cluster-issuer: letsencrypt-prod
    nginx.ingress.kubernetes.io/rate-limit: <span class="str">"100"</span>
  <span class="kw">hosts</span>:
    - <span class="kw">host</span>: api.example.com
      <span class="kw">paths</span>:
        - <span class="kw">path</span>: /
          <span class="kw">pathType</span>: Prefix
  <span class="kw">tls</span>:
    - <span class="kw">secretName</span>: my-java-app-tls
      <span class="kw">hosts</span>: [api.example.com]

<span class="cm"># ---- Environment ----</span>
<span class="kw">env</span>:
  - <span class="kw">name</span>: SERVER_PORT
    <span class="kw">value</span>: <span class="str">"8080"</span>
  - <span class="kw">name</span>: MANAGEMENT_ENDPOINTS_WEB_EXPOSURE_INCLUDE
    <span class="kw">value</span>: <span class="str">"health,metrics,prometheus,info"</span>
  - <span class="kw">name</span>: SPRING_APPLICATION_NAME
    <span class="kw">value</span>: my-java-app

<span class="cm"># ---- Pod Annotations (Prometheus scrape) ----</span>
<span class="kw">podAnnotations</span>:
  prometheus.io/scrape: <span class="str">"true"</span>
  prometheus.io/port: <span class="str">"8080"</span>
  prometheus.io/path: <span class="str">"/actuator/prometheus"</span>

<span class="cm"># ---- Scheduling ----</span>
<span class="kw">affinity</span>:
  <span class="kw">podAntiAffinity</span>:
    <span class="kw">preferredDuringSchedulingIgnoredDuringExecution</span>:
      - <span class="kw">weight</span>: 100
        <span class="kw">podAffinityTerm</span>:
          <span class="kw">labelSelector</span>:
            <span class="kw">matchExpressions</span>:
              - <span class="kw">key</span>: app
                <span class="kw">operator</span>: In
                <span class="kw">values</span>: [my-java-app]
          <span class="kw">topologyKey</span>: kubernetes.io/hostname

<span class="kw">strategy</span>:
  <span class="kw">type</span>: RollingUpdate
  <span class="kw">rollingUpdate</span>:
    <span class="kw">maxSurge</span>: 1
    <span class="kw">maxUnavailable</span>: 0           <span class="cm"># Zero-downtime rollouts</span></pre>
</section>

<!-- ============================================================ -->
<section id="helm-templates">
<h2><span class="section-icon">&#128196;</span> Helm Templates</h2>

<h3>templates/deployment.yaml</h3>
<pre data-lang="yaml"><span class="kw">apiVersion</span>: apps/v1
<span class="kw">kind</span>: Deployment
<span class="kw">metadata</span>:
  <span class="kw">name</span>: {{ include "my-java-app.fullname" . }}
  <span class="kw">labels</span>:
    {{- include "my-java-app.labels" . | nindent 4 }}
<span class="kw">spec</span>:
  {{- if not .Values.autoscaling.enabled }}
  <span class="kw">replicas</span>: {{ .Values.replicaCount }}
  {{- end }}
  <span class="kw">strategy</span>:
    {{- toYaml .Values.strategy | nindent 4 }}
  <span class="kw">selector</span>:
    <span class="kw">matchLabels</span>:
      {{- include "my-java-app.selectorLabels" . | nindent 6 }}
  <span class="kw">template</span>:
    <span class="kw">metadata</span>:
      <span class="kw">annotations</span>:
        <span class="cm"># Trigger rollout on ConfigMap change</span>
        checksum/config: {{ include (print $.Template.BasePath "/configmap.yaml") . | sha256sum }}
        {{- with .Values.podAnnotations }}
        {{- toYaml . | nindent 8 }}
        {{- end }}
      <span class="kw">labels</span>:
        {{- include "my-java-app.selectorLabels" . | nindent 8 }}
    <span class="kw">spec</span>:
      <span class="kw">serviceAccountName</span>: {{ include "my-java-app.serviceAccountName" . }}
      <span class="kw">securityContext</span>:
        {{- toYaml .Values.podSecurityContext | nindent 8 }}
      <span class="kw">containers</span>:
        - <span class="kw">name</span>: {{ .Chart.Name }}
          <span class="kw">image</span>: "{{ .Values.image.repository }}:{{ .Values.image.tag }}"
          <span class="kw">imagePullPolicy</span>: {{ .Values.image.pullPolicy }}
          <span class="kw">ports</span>:
            - <span class="kw">name</span>: http
              <span class="kw">containerPort</span>: 8080
          <span class="kw">env</span>:
            {{- toYaml .Values.env | nindent 12 }}
          <span class="kw">resources</span>:
            {{- toYaml .Values.resources | nindent 12 }}
          <span class="kw">securityContext</span>:
            {{- toYaml .Values.securityContext | nindent 12 }}
          <span class="kw">volumeMounts</span>:
            - <span class="kw">name</span>: tmp
              <span class="kw">mountPath</span>: /tmp
      <span class="kw">volumes</span>:
        - <span class="kw">name</span>: tmp
          <span class="kw">emptyDir</span>: {}
      {{- with .Values.affinity }}
      <span class="kw">affinity</span>:
        {{- toYaml . | nindent 8 }}
      {{- end }}</pre>

<h3>templates/service.yaml</h3>
<pre data-lang="yaml"><span class="kw">apiVersion</span>: v1
<span class="kw">kind</span>: Service
<span class="kw">metadata</span>:
  <span class="kw">name</span>: {{ include "my-java-app.fullname" . }}
  <span class="kw">labels</span>:
    {{- include "my-java-app.labels" . | nindent 4 }}
<span class="kw">spec</span>:
  <span class="kw">type</span>: {{ .Values.service.type }}
  <span class="kw">ports</span>:
    - <span class="kw">port</span>: {{ .Values.service.port }}
      <span class="kw">targetPort</span>: http
      <span class="kw">protocol</span>: TCP
      <span class="kw">name</span>: http
  <span class="kw">selector</span>:
    {{- include "my-java-app.selectorLabels" . | nindent 4 }}</pre>

<h3>templates/ingress.yaml</h3>
<pre data-lang="yaml">{{- if .Values.ingress.enabled -}}
<span class="kw">apiVersion</span>: networking.k8s.io/v1
<span class="kw">kind</span>: Ingress
<span class="kw">metadata</span>:
  <span class="kw">name</span>: {{ include "my-java-app.fullname" . }}
  <span class="kw">labels</span>:
    {{- include "my-java-app.labels" . | nindent 4 }}
  {{- with .Values.ingress.annotations }}
  <span class="kw">annotations</span>:
    {{- toYaml . | nindent 4 }}
  {{- end }}
<span class="kw">spec</span>:
  <span class="kw">ingressClassName</span>: {{ .Values.ingress.className }}
  {{- if .Values.ingress.tls }}
  <span class="kw">tls</span>:
    {{- range .Values.ingress.tls }}
    - <span class="kw">hosts</span>:
        {{- range .hosts }}
        - {{ . | quote }}
        {{- end }}
      <span class="kw">secretName</span>: {{ .secretName }}
    {{- end }}
  {{- end }}
  <span class="kw">rules</span>:
    {{- range .Values.ingress.hosts }}
    - <span class="kw">host</span>: {{ .host | quote }}
      <span class="kw">http</span>:
        <span class="kw">paths</span>:
          {{- range .paths }}
          - <span class="kw">path</span>: {{ .path }}
            <span class="kw">pathType</span>: {{ .pathType }}
            <span class="kw">backend</span>:
              <span class="kw">service</span>:
                <span class="kw">name</span>: {{ include "my-java-app.fullname" $ }}
                <span class="kw">port</span>:
                  <span class="kw">number</span>: {{ $.Values.service.port }}
          {{- end }}
    {{- end }}
{{- end }}</pre>
</section>

<!-- ============================================================ -->
<section id="helm-ops">
<h2><span class="section-icon">&#128640;</span> Helm Operations</h2>

<pre data-lang="bash"><span class="cm"># ---- Validate ----</span>
helm lint helm/my-java-app --strict
helm template my-java-app helm/my-java-app --values values-dev.yaml

<span class="cm"># ---- Install ----</span>
helm install my-java-app helm/my-java-app \
  --namespace dev --create-namespace \
  --values helm/my-java-app/values-dev.yaml \
  --wait --timeout 5m

<span class="cm"># ---- Upgrade (or install if not exists) ----</span>
helm upgrade --install my-java-app helm/my-java-app \
  --namespace dev --atomic --timeout 5m

<span class="cm"># ---- Diff before upgrade (requires helm-diff plugin) ----</span>
helm diff upgrade my-java-app helm/my-java-app \
  --values values-dev.yaml -n dev

<span class="cm"># ---- Inspect ----</span>
helm get values my-java-app -n dev
helm get manifest my-java-app -n dev
helm history my-java-app -n dev

<span class="cm"># ---- Rollback ----</span>
helm rollback my-java-app 1 -n dev

<span class="cm"># ---- Package &amp; Distribute ----</span>
helm package helm/my-java-app --version 1.0.0
helm push my-java-app-1.0.0.tgz oci://registry.company.com/charts

<span class="cm"># ---- Cleanup ----</span>
helm uninstall my-java-app -n dev</pre>

<div class="callout tip"><strong>Always use <code>--atomic</code>.</strong><p> On failed upgrades, <code>--atomic</code> auto-rolls back to the last successful release. Without it, you're left in a broken half-deployed state.</p></div>
</section>

<!-- ============================================================ -->
<section id="k8s-prep">
<h2><span class="section-icon">&#9096;</span> Kubernetes Setup</h2>

<pre data-lang="bash"><span class="cm"># Verify cluster access</span>
kubectl cluster-info
kubectl get nodes -o wide

<span class="cm"># Create namespaces</span>
kubectl create namespace dev
kubectl create namespace staging
kubectl create namespace production

<span class="cm"># Create image pull secret</span>
kubectl create secret docker-registry regcred \
  --docker-server=my-registry.azurecr.io \
  --docker-username=$REGISTRY_USER \
  --docker-password=$REGISTRY_TOKEN \
  -n dev

<span class="cm"># Set default namespace for context</span>
kubectl config set-context --current --namespace=dev

<span class="cm"># Deploy via Helm</span>
helm install my-java-app helm/my-java-app \
  --namespace dev --create-namespace \
  --values values-dev.yaml --wait --timeout 5m

<span class="cm"># Verify</span>
kubectl get deployment,pods,svc -n dev
kubectl logs -n dev -l app=my-java-app --tail=50

<span class="cm"># Port forward for local testing</span>
kubectl port-forward -n dev svc/my-java-app 8080:8080</pre>
</section>

<!-- ============================================================ -->
<section id="k8s-manifests">
<h2><span class="section-icon">&#128221;</span> Raw K8s Manifests</h2>
<p>For teams that prefer raw YAML over Helm, or for understanding what Helm generates.</p>

<h3>Deployment + Service</h3>
<pre data-lang="yaml"><span class="kw">apiVersion</span>: apps/v1
<span class="kw">kind</span>: Deployment
<span class="kw">metadata</span>:
  <span class="kw">name</span>: my-java-app
  <span class="kw">namespace</span>: dev
<span class="kw">spec</span>:
  <span class="kw">replicas</span>: 3
  <span class="kw">strategy</span>:
    <span class="kw">type</span>: RollingUpdate
    <span class="kw">rollingUpdate</span>: { <span class="kw">maxSurge</span>: 1, <span class="kw">maxUnavailable</span>: 0 }
  <span class="kw">selector</span>:
    <span class="kw">matchLabels</span>: { <span class="kw">app</span>: my-java-app }
  <span class="kw">template</span>:
    <span class="kw">metadata</span>:
      <span class="kw">labels</span>: { <span class="kw">app</span>: my-java-app, <span class="kw">version</span>: "1.0.0" }
      <span class="kw">annotations</span>:
        prometheus.io/scrape: <span class="str">"true"</span>
        prometheus.io/port: <span class="str">"8080"</span>
        prometheus.io/path: <span class="str">"/actuator/prometheus"</span>
    <span class="kw">spec</span>:
      <span class="kw">serviceAccountName</span>: my-java-app
      <span class="kw">securityContext</span>:
        <span class="kw">runAsNonRoot</span>: <span class="kw">true</span>
        <span class="kw">runAsUser</span>: 1000
        <span class="kw">seccompProfile</span>: { <span class="kw">type</span>: RuntimeDefault }
      <span class="kw">containers</span>:
      - <span class="kw">name</span>: app
        <span class="kw">image</span>: my-registry.azurecr.io/my-java-app:1.0.0
        <span class="kw">ports</span>:
        - { <span class="kw">name</span>: http, <span class="kw">containerPort</span>: 8080 }
        <span class="kw">env</span>:
        - { <span class="kw">name</span>: SPRING_PROFILES_ACTIVE, <span class="kw">value</span>: <span class="str">"kubernetes,dev"</span> }
        - { <span class="kw">name</span>: JAVA_OPTS, <span class="kw">value</span>: <span class="str">"-XX:+UseG1GC -XX:MaxRAMPercentage=75.0"</span> }
        <span class="kw">resources</span>:
          <span class="kw">requests</span>: { <span class="kw">cpu</span>: 250m, <span class="kw">memory</span>: 256Mi }
          <span class="kw">limits</span>:   { <span class="kw">cpu</span>: 500m, <span class="kw">memory</span>: 512Mi }
        <span class="kw">startupProbe</span>:
          <span class="kw">httpGet</span>: { <span class="kw">path</span>: /actuator/health/startup, <span class="kw">port</span>: http }
          <span class="kw">periodSeconds</span>: 10
          <span class="kw">failureThreshold</span>: 30
        <span class="kw">readinessProbe</span>:
          <span class="kw">httpGet</span>: { <span class="kw">path</span>: /actuator/health/readiness, <span class="kw">port</span>: http }
          <span class="kw">initialDelaySeconds</span>: 5
          <span class="kw">periodSeconds</span>: 10
        <span class="kw">livenessProbe</span>:
          <span class="kw">httpGet</span>: { <span class="kw">path</span>: /actuator/health/liveness, <span class="kw">port</span>: http }
          <span class="kw">initialDelaySeconds</span>: 60
        <span class="kw">securityContext</span>:
          <span class="kw">allowPrivilegeEscalation</span>: <span class="kw">false</span>
          <span class="kw">capabilities</span>: { <span class="kw">drop</span>: [ALL] }
          <span class="kw">readOnlyRootFilesystem</span>: <span class="kw">true</span>
        <span class="kw">volumeMounts</span>:
        - { <span class="kw">name</span>: tmp, <span class="kw">mountPath</span>: /tmp }
      <span class="kw">volumes</span>:
      - { <span class="kw">name</span>: tmp, <span class="kw">emptyDir</span>: {} }
      <span class="kw">imagePullSecrets</span>:
      - { <span class="kw">name</span>: regcred }
      <span class="kw">affinity</span>:
        <span class="kw">podAntiAffinity</span>:
          <span class="kw">preferredDuringSchedulingIgnoredDuringExecution</span>:
          - <span class="kw">weight</span>: 100
            <span class="kw">podAffinityTerm</span>:
              <span class="kw">labelSelector</span>:
                <span class="kw">matchLabels</span>: { <span class="kw">app</span>: my-java-app }
              <span class="kw">topologyKey</span>: kubernetes.io/hostname
---
<span class="kw">apiVersion</span>: v1
<span class="kw">kind</span>: Service
<span class="kw">metadata</span>:
  <span class="kw">name</span>: my-java-app
  <span class="kw">namespace</span>: dev
<span class="kw">spec</span>:
  <span class="kw">type</span>: ClusterIP
  <span class="kw">ports</span>:
  - { <span class="kw">port</span>: 8080, <span class="kw">targetPort</span>: http, <span class="kw">name</span>: http }
  <span class="kw">selector</span>: { <span class="kw">app</span>: my-java-app }</pre>

<h3>HPA</h3>
<pre data-lang="yaml"><span class="kw">apiVersion</span>: autoscaling/v2
<span class="kw">kind</span>: HorizontalPodAutoscaler
<span class="kw">metadata</span>:
  <span class="kw">name</span>: my-java-app
  <span class="kw">namespace</span>: dev
<span class="kw">spec</span>:
  <span class="kw">scaleTargetRef</span>:
    <span class="kw">apiVersion</span>: apps/v1
    <span class="kw">kind</span>: Deployment
    <span class="kw">name</span>: my-java-app
  <span class="kw">minReplicas</span>: 2
  <span class="kw">maxReplicas</span>: 10
  <span class="kw">metrics</span>:
  - <span class="kw">type</span>: Resource
    <span class="kw">resource</span>:
      <span class="kw">name</span>: cpu
      <span class="kw">target</span>: { <span class="kw">type</span>: Utilization, <span class="kw">averageUtilization</span>: 75 }
  <span class="kw">behavior</span>:
    <span class="kw">scaleDown</span>:
      <span class="kw">stabilizationWindowSeconds</span>: 300   <span class="cm"># Wait 5m before scaling down</span>
    <span class="kw">scaleUp</span>:
      <span class="kw">stabilizationWindowSeconds</span>: 0     <span class="cm"># Scale up immediately</span></pre>
</section>

<!-- ============================================================ -->
<section id="health">
<h2><span class="section-icon">&#129657;</span> Health &amp; Monitoring</h2>

<h3>Spring Boot Actuator Config</h3>
<pre data-lang="yaml"><span class="cm"># application.yml</span>
<span class="kw">management</span>:
  <span class="kw">endpoints</span>:
    <span class="kw">web</span>:
      <span class="kw">exposure</span>:
        <span class="kw">include</span>: health,metrics,prometheus,info,threaddump
      <span class="kw">base-path</span>: /actuator
  <span class="kw">endpoint</span>:
    <span class="kw">health</span>:
      <span class="kw">show-details</span>: when-authorized
      <span class="kw">probes</span>:
        <span class="kw">enabled</span>: <span class="kw">true</span>            <span class="cm"># Enables /health/liveness &amp; /health/readiness</span>
  <span class="kw">metrics</span>:
    <span class="kw">export</span>:
      <span class="kw">prometheus</span>:
        <span class="kw">enabled</span>: <span class="kw">true</span>            <span class="cm"># Enables /actuator/prometheus</span>
    <span class="kw">tags</span>:
      <span class="kw">application</span>: ${spring.application.name}</pre>

<h3>Probe Endpoints</h3>
<table>
<tr><th>Probe</th><th>Endpoint</th><th>Purpose</th></tr>
<tr><td>Startup</td><td><code>/actuator/health/startup</code></td><td>Is the app ready to accept probes? (gates liveness/readiness)</td></tr>
<tr><td>Readiness</td><td><code>/actuator/health/readiness</code></td><td>Can the app handle traffic? (controls Service endpoints)</td></tr>
<tr><td>Liveness</td><td><code>/actuator/health/liveness</code></td><td>Is the app alive? (failure triggers container restart)</td></tr>
</table>

<h3>Prometheus Scrape Annotations</h3>
<pre data-lang="yaml"><span class="cm"># In pod annotations (already in Helm values)</span>
<span class="kw">podAnnotations</span>:
  prometheus.io/scrape: <span class="str">"true"</span>
  prometheus.io/port: <span class="str">"8080"</span>
  prometheus.io/path: <span class="str">"/actuator/prometheus"</span></pre>

<pre data-lang="bash"><span class="cm"># Verify metrics endpoint is working</span>
kubectl port-forward -n dev svc/my-java-app 8080:8080
curl -s http://localhost:8080/actuator/prometheus | head -20

<span class="cm"># Key JVM metrics to watch:</span>
<span class="cm"># jvm_memory_used_bytes{area="heap"}</span>
<span class="cm"># jvm_gc_pause_seconds_sum</span>
<span class="cm"># jvm_threads_live_threads</span>
<span class="cm"># http_server_requests_seconds_count</span></pre>

<div class="callout tip"><strong>Grafana Dashboard:</strong><p> Import dashboard ID <strong>4701</strong> (JVM Micrometer) for instant Spring Boot observability. Pair with <strong>12740</strong> for Kubernetes pod metrics.</p></div>
</section>

<!-- ============================================================ -->
<section id="gitops">
<h2><span class="section-icon">&#128257;</span> GitOps with ArgoCD</h2>

<pre data-lang="yaml"><span class="kw">apiVersion</span>: argoproj.io/v1alpha1
<span class="kw">kind</span>: Application
<span class="kw">metadata</span>:
  <span class="kw">name</span>: my-java-app
  <span class="kw">namespace</span>: argocd
<span class="kw">spec</span>:
  <span class="kw">project</span>: default
  <span class="kw">source</span>:
    <span class="kw">repoURL</span>: https://github.com/company/my-java-app
    <span class="kw">targetRevision</span>: main
    <span class="kw">path</span>: helm/my-java-app
    <span class="kw">helm</span>:
      <span class="kw">valueFiles</span>:
      - values.yaml
      - values-prod.yaml
      <span class="kw">parameters</span>:
      - <span class="kw">name</span>: image.tag
        <span class="kw">value</span>: "1.0.0"
  <span class="kw">destination</span>:
    <span class="kw">server</span>: https://kubernetes.default.svc
    <span class="kw">namespace</span>: production
  <span class="kw">syncPolicy</span>:
    <span class="kw">automated</span>:
      <span class="kw">prune</span>: <span class="kw">true</span>           <span class="cm"># Delete resources removed from Git</span>
      <span class="kw">selfHeal</span>: <span class="kw">true</span>        <span class="cm"># Revert manual cluster changes</span>
    <span class="kw">syncOptions</span>:
    - CreateNamespace=true
    <span class="kw">retry</span>:
      <span class="kw">limit</span>: 3
      <span class="kw">backoff</span>:
        <span class="kw">duration</span>: 5s
        <span class="kw">maxDuration</span>: 3m</pre>

<div class="callout info"><strong>GitOps flow:</strong><p> CI pipeline builds image &rarr; updates <code>values.yaml</code> image tag in Git &rarr; ArgoCD detects drift &rarr; syncs new state to cluster. No <code>kubectl apply</code> in CI.</p></div>
</section>

<!-- ============================================================ -->
<section id="strategies">
<h2><span class="section-icon">&#127919;</span> Deployment Strategies</h2>

<h3>Blue-Green</h3>
<pre data-lang="bash"><span class="cm"># Deploy green (new version) alongside blue (current)</span>
helm install my-java-app-green helm/my-java-app \
  --namespace production \
  --set version=green \
  --set image.tag=1.1.0

<span class="cm"># Verify green is healthy</span>
kubectl rollout status deployment/my-java-app-green -n production

<span class="cm"># Switch traffic by updating Service selector</span>
kubectl patch svc my-java-app -n production \
  -p '{"spec":{"selector":{"version":"green"}}}'

<span class="cm"># Verify, then remove blue</span>
helm uninstall my-java-app-blue -n production</pre>

<h3>Canary with Istio</h3>
<pre data-lang="yaml"><span class="kw">apiVersion</span>: networking.istio.io/v1beta1
<span class="kw">kind</span>: VirtualService
<span class="kw">metadata</span>:
  <span class="kw">name</span>: my-java-app
<span class="kw">spec</span>:
  <span class="kw">hosts</span>: [my-java-app]
  <span class="kw">http</span>:
  - <span class="kw">route</span>:
    - <span class="kw">destination</span>:
        <span class="kw">host</span>: my-java-app
        <span class="kw">subset</span>: v1
      <span class="kw">weight</span>: 90              <span class="cm"># 90% to stable</span>
    - <span class="kw">destination</span>:
        <span class="kw">host</span>: my-java-app
        <span class="kw">subset</span>: v2
      <span class="kw">weight</span>: 10              <span class="cm"># 10% canary</span>
---
<span class="kw">apiVersion</span>: networking.istio.io/v1beta1
<span class="kw">kind</span>: DestinationRule
<span class="kw">metadata</span>:
  <span class="kw">name</span>: my-java-app
<span class="kw">spec</span>:
  <span class="kw">host</span>: my-java-app
  <span class="kw">trafficPolicy</span>:
    <span class="kw">outlierDetection</span>:
      <span class="kw">consecutiveErrors</span>: 5
      <span class="kw">interval</span>: 30s
      <span class="kw">baseEjectionTime</span>: 30s
  <span class="kw">subsets</span>:
  - <span class="kw">name</span>: v1
    <span class="kw">labels</span>: { <span class="kw">version</span>: v1 }
  - <span class="kw">name</span>: v2
    <span class="kw">labels</span>: { <span class="kw">version</span>: v2 }</pre>

<h3>Multi-Region</h3>
<pre data-lang="bash"><span class="cm"># Deploy to multiple clusters</span>
for cluster in us-east us-west eu-west; do
  kubectl config use-context $cluster
  helm upgrade --install my-java-app helm/my-java-app \
    --namespace production \
    --values values-${cluster}.yaml \
    --atomic --timeout 5m
done</pre>
</section>

<!-- ============================================================ -->
<section id="secrets-mgmt">
<h2><span class="section-icon">&#128274;</span> Secrets Management</h2>

<h3>Sealed Secrets (Bitnami)</h3>
<pre data-lang="bash"><span class="cm"># Create a secret, seal it, commit sealed version to Git</span>
echo -n 'mypassword' | kubectl create secret generic db-creds \
  --dry-run=client --from-file=password=/dev/stdin -o yaml | \
  kubeseal --format yaml > sealed-db-creds.yaml

<span class="cm"># Apply sealed secret (controller decrypts in-cluster)</span>
kubectl apply -f sealed-db-creds.yaml</pre>

<h3>External Secrets Operator</h3>
<pre data-lang="yaml"><span class="kw">apiVersion</span>: external-secrets.io/v1beta1
<span class="kw">kind</span>: ExternalSecret
<span class="kw">metadata</span>:
  <span class="kw">name</span>: db-credentials
<span class="kw">spec</span>:
  <span class="kw">refreshInterval</span>: 1h
  <span class="kw">secretStoreRef</span>:
    <span class="kw">name</span>: aws-secrets-manager
    <span class="kw">kind</span>: ClusterSecretStore
  <span class="kw">target</span>:
    <span class="kw">name</span>: db-credentials
  <span class="kw">data</span>:
  - <span class="kw">secretKey</span>: password
    <span class="kw">remoteRef</span>:
      <span class="kw">key</span>: production/db-credentials
      <span class="kw">property</span>: password</pre>

<div class="callout danger"><strong>Never commit secrets to Git.</strong><p> Use Sealed Secrets, External Secrets Operator, or inject from Vault/AWS SM/Azure KV at runtime. Base64 is encoding, not encryption.</p></div>
</section>

<!-- ============================================================ -->
<section id="troubleshooting">
<h2><span class="section-icon">&#128027;</span> Troubleshooting</h2>

<h3>Maven Build Issues</h3>
<pre data-lang="bash"><span class="cm"># Nuke local repo (nuclear option)</span>
rm -rf ~/.m2/repository

<span class="cm"># Force re-download all dependencies</span>
mvn clean package -U

<span class="cm"># Increase Maven memory</span>
export MAVEN_OPTS="-Xmx2048m -XX:+UseG1GC"

<span class="cm"># Find conflicting dependencies</span>
mvn dependency:tree -Dverbose | grep "omitted for conflict"

<span class="cm"># Verbose compilation output</span>
mvn clean compile -X 2>&1 | tail -100</pre>

<h3>Docker Issues</h3>
<pre data-lang="bash"><span class="cm"># Build fails: check disk space</span>
docker system df
docker image prune -a              <span class="cm"># Remove all unused images</span>
docker builder prune --all         <span class="cm"># Clear build cache</span>

<span class="cm"># Debug build (show full output)</span>
docker build --progress=plain --no-cache -t my-app:1.0.0 .

<span class="cm"># Registry push fails</span>
docker login my-registry.azurecr.io
docker image ls | grep my-java-app  <span class="cm"># Verify image exists locally</span></pre>

<h3>Kubernetes Pod Failures</h3>
<table>
<tr><th>Status</th><th>Cause</th><th>Debug Command</th></tr>
<tr><td><code>Pending</code></td><td>No node has enough resources</td><td><code>kubectl describe pod &lt;name&gt;</code> &rarr; Events</td></tr>
<tr><td><code>CrashLoopBackOff</code></td><td>App crashes on startup</td><td><code>kubectl logs &lt;pod&gt; --previous</code></td></tr>
<tr><td><code>ImagePullBackOff</code></td><td>Wrong image or missing credentials</td><td><code>kubectl describe pod</code> &rarr; check <code>imagePullSecrets</code></td></tr>
<tr><td><code>OOMKilled</code></td><td>Exceeded memory limit</td><td>Increase <code>limits.memory</code> or fix leak</td></tr>
<tr><td><code>CreateContainerConfigError</code></td><td>Missing ConfigMap/Secret</td><td>Verify referenced resources exist</td></tr>
</table>

<pre data-lang="bash"><span class="cm"># ---- Full Pod Debug Flow ----</span>

<span class="cm"># 1. Status overview</span>
kubectl get pods -n dev -o wide

<span class="cm"># 2. Detailed pod info + events</span>
kubectl describe pod &lt;name&gt; -n dev

<span class="cm"># 3. Logs (current + previous crash)</span>
kubectl logs &lt;pod&gt; -n dev --tail=200
kubectl logs &lt;pod&gt; -n dev --previous

<span class="cm"># 4. Exec into container</span>
kubectl exec -it &lt;pod&gt; -n dev -- /bin/sh

<span class="cm"># 5. Network debug</span>
kubectl run netshoot --rm -it --image=nicolaka/netshoot -n dev -- bash
<span class="cm"># Inside: dig my-java-app.dev.svc.cluster.local</span>
<span class="cm"># Inside: curl -sv http://my-java-app:8080/actuator/health</span>

<span class="cm"># 6. Check endpoints &amp; network policies</span>
kubectl get endpoints my-java-app -n dev
kubectl get networkpolicy -n dev

<span class="cm"># 7. Resource usage</span>
kubectl top pods -n dev --containers
kubectl top nodes</pre>

<h3>Performance Profiling in K8s</h3>
<pre data-lang="bash"><span class="cm"># Java Flight Recorder (in-pod profiling)</span>
kubectl exec -it &lt;pod&gt; -n dev -- \
  jcmd 1 JFR.start name=profile duration=60s filename=/tmp/profile.jfr

<span class="cm"># Extract recording</span>
kubectl cp dev/&lt;pod&gt;:/tmp/profile.jfr ./profile.jfr

<span class="cm"># Thread dump (deadlock analysis)</span>
kubectl exec &lt;pod&gt; -n dev -- jcmd 1 Thread.print

<span class="cm"># Heap dump (memory leak analysis)</span>
kubectl exec &lt;pod&gt; -n dev -- jcmd 1 GC.heap_dump /tmp/heap.hprof
kubectl cp dev/&lt;pod&gt;:/tmp/heap.hprof ./heap.hprof</pre>

<h3>Helm Troubleshooting</h3>
<pre data-lang="bash"><span class="cm"># Template rendering issues</span>
helm install my-java-app ./helm/my-java-app --dry-run --debug

<span class="cm"># Lint for syntax errors</span>
helm lint ./helm/my-java-app --strict

<span class="cm"># Check release status</span>
helm history my-java-app -n dev

<span class="cm"># Rollback (auto-rollback with --atomic on upgrade)</span>
helm rollback my-java-app 1 -n dev --cleanup-on-fail</pre>

<h3>Certificate &amp; RBAC Issues</h3>
<pre data-lang="bash"><span class="cm"># Check cert expiry</span>
kubectl get secret my-java-app-tls -o jsonpath='{.data.tls\.crt}' | \
  base64 -d | openssl x509 -noout -dates

<span class="cm"># Check service account permissions</span>
kubectl auth can-i get pods \
  --as=system:serviceaccount:dev:my-java-app -n dev

<span class="cm"># List all bindings for a namespace</span>
kubectl get rolebindings -n dev -o wide</pre>
</section>

<!-- ============================================================ -->
<section id="jvm-tuning">
<h2><span class="section-icon">&#9881;</span> JVM Tuning for Containers</h2>
<p>Java in containers has specific gotchas. These flags are essential for production.</p>

<h3>Recommended JVM Flags</h3>
<pre data-lang="bash">JAVA_OPTS="
  -XX:+UseG1GC                     <span class="cm"># G1 GC (best for most workloads)</span>
  -XX:MaxRAMPercentage=75.0         <span class="cm"># Use 75% of container memory limit</span>
  -XX:InitialRAMPercentage=50.0     <span class="cm"># Start at 50% to reduce GC on startup</span>
  -XX:+UseStringDeduplication       <span class="cm"># Reduce heap for string-heavy apps</span>
  -XX:+ExitOnOutOfMemoryError       <span class="cm"># Let K8s restart on OOM (don't hang)</span>
  -XX:+HeapDumpOnOutOfMemoryError   <span class="cm"># Dump heap before crashing</span>
  -XX:HeapDumpPath=/tmp/heapdump.hprof
  -Djava.security.egd=file:/dev/./urandom  <span class="cm"># Faster startup (SecureRandom)</span>
  -Dfile.encoding=UTF-8
"</pre>

<h3>Container-Aware Memory</h3>
<table>
<tr><th>Flag</th><th>Effect</th><th>When to Use</th></tr>
<tr><td><code>-XX:MaxRAMPercentage=75.0</code></td><td>Heap = 75% of container memory limit</td><td>Always (replaces <code>-Xmx</code>)</td></tr>
<tr><td><code>-XX:InitialRAMPercentage=50.0</code></td><td>Initial heap = 50% of limit</td><td>Reduce GC during warmup</td></tr>
<tr><td><code>-XX:MinRAMPercentage=25.0</code></td><td>Minimum heap for small containers</td><td>Containers &lt; 256Mi</td></tr>
</table>

<div class="callout warn"><strong>Don't use <code>-Xmx</code> in containers.</strong><p> Hard-coded <code>-Xmx512m</code> ignores the container's actual memory limit. Use <code>-XX:MaxRAMPercentage</code> instead &mdash; it adapts to whatever K8s gives you. Leave 25% headroom for off-heap (metaspace, threads, NIO buffers).</p></div>

<h3>GC Selection Guide</h3>
<table>
<tr><th>GC</th><th>Best For</th><th>Flag</th></tr>
<tr><td><strong>G1GC</strong></td><td>General purpose, balanced latency/throughput</td><td><code>-XX:+UseG1GC</code></td></tr>
<tr><td><strong>ZGC</strong></td><td>Ultra-low latency (&lt;1ms pauses), large heaps</td><td><code>-XX:+UseZGC</code></td></tr>
<tr><td><strong>Shenandoah</strong></td><td>Low latency (OpenJDK only)</td><td><code>-XX:+UseShenandoahGC</code></td></tr>
<tr><td><strong>SerialGC</strong></td><td>Small containers (&lt;256Mi), single-core</td><td><code>-XX:+UseSerialGC</code></td></tr>
</table>

<h3>Startup Optimization</h3>
<pre data-lang="bash"><span class="cm"># CDS (Class Data Sharing) - reduces startup by 20-30%</span>
<span class="cm"># Step 1: Generate class list during build</span>
java -XX:DumpLoadedClassList=classes.lst -jar app.jar --exit

<span class="cm"># Step 2: Create shared archive</span>
java -Xshare:dump -XX:SharedClassListFile=classes.lst \
  -XX:SharedArchiveFile=app-cds.jsa -jar app.jar

<span class="cm"># Step 3: Use in container ENTRYPOINT</span>
java -Xshare:on -XX:SharedArchiveFile=app-cds.jsa -jar app.jar

<span class="cm"># Spring Boot specific: use lazy initialization for dev</span>
<span class="cm"># spring.main.lazy-initialization=true  (NOT for production)</span></pre>
</section>

<!-- ============================================================ -->
<section id="checklist">
<h2><span class="section-icon">&#9745;</span> Deployment Checklist</h2>

<h3>Pre-Deployment</h3>
<ul class="checklist">
  <li>Java application compiles successfully (<code>mvn clean package</code>)</li>
  <li>All unit tests pass (<code>mvn test</code>)</li>
  <li>Code quality gates met (SonarQube/Checkstyle)</li>
  <li>No HIGH/CRITICAL dependency vulnerabilities (OWASP check)</li>
  <li>Docker image builds without errors (multi-stage)</li>
  <li>Image CVE scan passes (Trivy/Scout)</li>
  <li>Helm chart lints without errors (<code>helm lint --strict</code>)</li>
  <li>Non-root user in container</li>
  <li>Image tagged with immutable version (not <code>:latest</code>)</li>
</ul>

<h3>Deployment</h3>
<ul class="checklist">
  <li>Kubernetes cluster is accessible (<code>kubectl cluster-info</code>)</li>
  <li>Image pull secrets created in target namespace</li>
  <li>Namespace created with resource quotas</li>
  <li>Network policies defined (default-deny + allow rules)</li>
  <li>RBAC roles &amp; service accounts configured</li>
  <li>ConfigMaps &amp; Secrets deployed before app</li>
  <li>Helm <code>--atomic</code> flag used for safe rollback</li>
</ul>

<h3>Post-Deployment</h3>
<ul class="checklist">
  <li>All pods running and Ready (<code>kubectl get pods</code>)</li>
  <li>Startup, readiness &amp; liveness probes passing</li>
  <li>Service endpoints populated (<code>kubectl get endpoints</code>)</li>
  <li>Ingress routing configured with TLS</li>
  <li>Prometheus scraping metrics (<code>/actuator/prometheus</code>)</li>
  <li>HPA configured and responding to load</li>
  <li>PDB in place for safe voluntary disruptions</li>
  <li>Smoke tests passing from inside the cluster</li>
  <li>Alerting rules configured (error rate, latency, OOM)</li>
</ul>
</section>

<!-- ============================================================ -->
<footer>
  <p>Java HTTP App DevOps Pipeline Manual &mdash; From <code>mvn clean</code> to production.</p>
  <p style="margin-top:.5rem;font-size:.7rem">
    <a href="https://maven.apache.org/">Maven</a> &middot;
    <a href="https://spring.io/projects/spring-boot">Spring Boot</a> &middot;
    <a href="https://docs.docker.com/">Docker</a> &middot;
    <a href="https://kubernetes.io/docs/">Kubernetes</a> &middot;
    <a href="https://helm.sh/docs/">Helm</a> &middot;
    <a href="https://www.jenkins.io/doc/">Jenkins</a>
  </p>
</footer>

</main>
</div>

<script>
// Sidebar toggle (mobile)
const hamburger=document.getElementById('hamburger'),sidebar=document.getElementById('sidebar'),overlay=document.getElementById('overlay');
hamburger.onclick=()=>{sidebar.classList.toggle('open');overlay.classList.toggle('show')};
overlay.onclick=()=>{sidebar.classList.remove('open');overlay.classList.remove('show')};

// Scroll progress bar
window.addEventListener('scroll',()=>{
  const h=document.documentElement,b=document.body;
  const pct=(h.scrollTop||b.scrollTop)/((h.scrollHeight||b.scrollHeight)-h.clientHeight)*100;
  document.getElementById('progress').style.width=Math.min(pct,100)+'%';
});

// Active nav link highlighting on scroll
const sections=document.querySelectorAll('section[id]');
const navLinks=document.querySelectorAll('nav a[href^="#"]');
const obs=new IntersectionObserver(entries=>{
  entries.forEach(e=>{
    if(e.isIntersecting){
      navLinks.forEach(l=>l.classList.remove('active'));
      const a=document.querySelector(`nav a[href="#${e.target.id}"]`);
      if(a)a.classList.add('active');
    }
  });
},{rootMargin:'-15% 0px -65% 0px'});
sections.forEach(s=>obs.observe(s));

// Close sidebar on mobile nav click
navLinks.forEach(l=>l.addEventListener('click',()=>{
  sidebar.classList.remove('open');overlay.classList.remove('show');
}));
</script>
</body>
</html>